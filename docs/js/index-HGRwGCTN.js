import{d as k,aa as t,o as h,c as C,i as x,e as M,f as l,j as r,ae as I,J as D,z as Y,D as A,a1 as F,L as T,q as y,ab as z,af as b,K as B,ag as P,h as N,b as U}from"./vendor-RGK81Rd9.js";import"./index-awFttPXd.js";import{u as $,a as E,B as V,_ as q,c as L,A as S,e as O,d as _,g as W,f as R}from"./secretHierarchyEnum-jbaofLgQ.js";import{D as j}from"./deviceCategoryEnum-upQNdLAM.js";import{a as H}from"./useModalForm-psK_Mvxo.js";const J={style:{height:"500px"}},K=k({__name:"deviceSelector",props:{modelValue:{}},setup(f){const c=f,{table:m,selected:o,refresh:u,data:g}=$(),p=E(Array.from({length:20},(a,e)=>({id:t.Random.id(),code:`DEV-${e+1}`,name:`设备名称 ${e+1}`,model:`型号 ${e+1}`,brand:`品牌 ${e+1}`,category:t.Random.pick([0,1,2,3,4,5,6]),security:t.Random.pick([0,1,2,3]),manufacturer:`厂商 ${e+1}`,quantity:t.Random.natural(1,100),unit:t.Random.pick(["个","台"]),registeredBy:t.Random.cname(),registerDate:t.Random.date("yyyy-MM-dd"),purchaseDate:t.Random.date("yyyy-MM-dd")}))),d=[{label:"设备编号",name:"code",component:"Input"},{label:"设备名称",name:"name",component:"Input"},{label:"设备型号",name:"model",component:"Input"},{label:"设备品牌",name:"brand",component:"Input"},{label:"设备类别",name:"category",component:"Select",props:{options:[{label:"类别1",value:"类别1"},{label:"类别2",value:"类别2"},{label:"类别3",value:"类别3"}]}}],i=[{title:"设备编号",dataIndex:"code",align:"left"},{title:"设备名称",dataIndex:"name",align:"center"},{title:"设备型号",dataIndex:"model",align:"center"},{title:"设备品牌",dataIndex:"brand",align:"center"},{title:"设备类别",dataIndex:"category",align:"center",render:({record:a})=>j[a.category]},{title:"设备密级",dataIndex:"security",align:"center",render:({record:a})=>{const e=L[a.security];return l(D,{status:e.status,text:e.text},null)}}],n=async()=>{const a=m.value.data.filter(e=>o.value.includes(e.id));return c.modelValue.value.push(...a),!0};return(a,e)=>(h(),C(r(q),{width:"800px",loading:a.loading,"body-style":{padding:"10px 10px"},onBeforeConfirm:n},{default:x(()=>[M("div",J,[l(r(V),{selected:r(o),"onUpdate:selected":e[0]||(e[0]=s=>I(o)?o.value=s:null),ref_key:"table",ref:m,"row-key":"id",selection:"checkbox",service:r(p),"table-filter":d,"table-columns":i},null,8,["selected","service"])])]),_:1},8,["loading"]))}}),G={style:{"margin-bottom":"10px"}},w=k({__name:"editor",props:{mode:{},record:{}},setup(f){const c=f,{form:m,dataSource:o,loading:u,validate:g}=H(),p=[{label:"报废原因",name:"result",span:8,component:"Input",required:!0},{label:"报废内容",name:"content",span:8,component:"Input",required:!0},{label:"报废人",name:"appliance",span:8,component:"Input",required:!0},{label:"审核人",name:"moderator",span:8,component:"Select",required:!0},{label:"报废时间",name:"time",span:8,component:"DatePicker",required:!0,disabled:!0},{label:"状态",name:"status",span:8,component:"Select",required:!0,disabled:!0,props:{options:[...S]}}],d=Y([]),i=[{title:"序号",dataIndex:"code",align:"center",width:80,render:({rowIndex:e})=>e+1},{title:"待报废设备编号",dataIndex:"code",align:"center"},{title:"待报废设备名称",dataIndex:"name",align:"center"},{title:"待报废设备型号",dataIndex:"model",align:"center"},{title:"操作",align:"center",width:80,render:({record:e})=>l(B,{size:10},{default:()=>[l(b,{onClick:()=>n.onDelete([e.id])},{default:()=>[y("移除")]})]})}],n={onCreate:async()=>{await _(K,{title:"添加设备",modelValue:d})},onDelete:async e=>{const s=d.value.filter(v=>!e.includes(v.id));d.value=s}},a=async()=>await g()?!1:(P.success("操作成功"),!0);return A(()=>{F(()=>{c.mode==="edit"&&(o.value={...c.record},d.value=c.record.devices?[...c.record.devices]:[])})}),(e,s)=>(h(),C(r(q),{width:"1000px",loading:r(u),onBeforeConfirm:a},{default:x(()=>[l(r(O),{"label-width":"70px",ref_key:"form",ref:m,modelValue:r(o),"onUpdate:modelValue":s[0]||(s[0]=v=>I(o)?o.value=v:null),configs:p,layout:"horizontal"},null,8,["modelValue"]),M("div",G,[l(r(T),{type:"primary",onClick:n.onCreate},{default:x(()=>[y("添加设备")]),_:1},8,["onClick"])]),l(r(z),{size:"small",columns:i,data:d.value,bordered:{cell:!0},pagination:!1,scroll:{y:300}},null,8,["data"])]),_:1},8,["loading"]))}}),Q={class:"page"},ne=k({__name:"index",setup(f){const c=E(Array.from({length:20},(n,a)=>({id:t.Random.id(),result:t.Random.title(),content:t.Random.title(),appliance:t.Random.cname(),time:t.Random.date("yyyy-MM-dd"),moderator:t.Random.cname(),status:t.Random.pick([0,1,2,3,4,5,6]),devices:Array.from({length:2},(e,s)=>({id:t.Random.id(),code:`DEV-${s+1}`,name:`设备名称 ${s+1}`,model:`型号 ${s+1}`,brand:`品牌 ${s+1}`,category:t.Random.pick([0,1,2,3,4,5,6]),security:t.Random.pick([0,1,2,3]),manufacturer:`厂商 ${s+1}`,quantity:t.Random.natural(1,100),unit:t.Random.pick(["个","台"]),registeredBy:t.Random.cname(),registerDate:t.Random.date("yyyy-MM-dd"),purchaseDate:t.Random.date("yyyy-MM-dd")}))}))),{table:m,selected:o,refresh:u}=$(),g=[{label:"报废原因",name:"result",component:"Input"},{label:"报废内容",name:"content",component:"Input"},{label:"状态",name:"status",component:"Select",props:{options:[...S]}},{label:"起止时间",name:"range",component:"RangePicker",props:{placeholder:["起始时间","结束时间"],format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD"}}],p=N(()=>[{text:"新增申请",type:"primary",onClick:()=>i.onCreate()},{text:"批量删除",type:"primary",status:"danger",disabled:o.value.length===0,onClick:()=>i.onDelete(o.value)}]),d=[{title:"报废原因",dataIndex:"result",align:"left",ellipsis:!0,tooltip:!0},{title:"报废内容",dataIndex:"content",align:"left",ellipsis:!0,tooltip:!0},{title:"报废人",dataIndex:"appliance",align:"center",width:120},{title:"报废时间",dataIndex:"time",align:"center",width:160},{title:"审核人",dataIndex:"moderator",align:"center",width:120},{title:"状态",dataIndex:"status",align:"center",width:160,render:({record:n})=>{const a=W[n.status];return l(D,{status:a.status,text:a.text},null)}},{title:"操作",align:"center",width:160,render:({record:n})=>l(B,{size:10},{default:()=>[l(b,{onClick:()=>i.onEdit(n)},{default:()=>[y("编辑")]}),l(b,{onClick:()=>i.onWithdraw(n)},{default:()=>[y("撤回")]}),l(b,{onClick:()=>i.onDelete([n.id])},{default:()=>[y("删除")]})]})}],i={onCreate:async()=>{await _(w,{mode:"create",title:"新增报废申请"})&&u()},onEdit:async n=>{await _(w,{mode:"edit",title:"编辑报废申请",record:n})&&u()},onWithdraw:async n=>{await R("撤回",async()=>{})&&u()},onDelete:async n=>{await R("删除",async()=>{})&&u()}};return(n,a)=>(h(),U("div",Q,[l(r(V),{selected:r(o),"onUpdate:selected":a[0]||(a[0]=e=>I(o)?o.value=e:null),ref_key:"table",ref:m,title:"我的报废列表","row-key":"result",selection:"checkbox",service:r(c),"table-filter":g,"table-operates":p.value,"table-columns":d},null,8,["selected","service","table-operates"])]))}});export{ne as default};
